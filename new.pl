%───────────────▄████████▄────────
%─────────────▄█▀▒▒▒▒▒▒▒▀██▄──────
%───────────▄█▀▒▒▒▒▒▒▒▒▒▒▒██──────
%─────────▄█▀▒▒▒▒▒▒▄▒▒▒▒▒▒▐█▌─────
%────────▄█▒▒▒▒▒▒▒▒▀█▒▒▒▒▒▐█▌─────
%───────▄█▒▒▒▒▒▒▒▒▒▒▀█▒▒▒▄██──────
%──────▄█▒▒▒▒▒▒▒▒▒▒▒▒▀█▒▄█▀█▄─────
%─────▄█▒▒▒▒▒▒▒▒▒▒▒▒▒▒██▀▒▒▒█▄────
%────▄█▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒█▄───
%───▄█▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒█▄──
%──▄█▒▒▒▄██████▄▒▒▒▒▄█████▄▒▒▒▒█──			 ______                      __                           
%──█▒▒▒█▀░░░░░▀█─▒▒▒█▀░░░░▀█▒▒▒█──			|      \                    |  \                 
%──█▒▒▒█░░▄░░░░▀████▀░░░▄░░█▒▒▒█──			|$$$$$$$\  ______   ______  | $$   __   ______   __    __ 
%▄███▄▒█▄░▐▀▄░░░░░░░░░▄▀▌░▄█▒▒███▄			|$$  | $$ /      \ |      \ | $$  /  \ /      \ |  \  |  \					
%█▀░░█▄▒█░▐▐▀▀▄▄▄─▄▄▄▀▀▌▌░█▒▒█░░▀█			|$$  | $$|  $$$$$$\|$$$$$$$\| $$_/  $$|  $$$$$$\| $$  | $$			▒▒▒▒▒▒▒▒▒▄▄▄▄▒▒▒▒▒▒▒
%█░░░░█▒█░▐▐──▄▄─█─▄▄──▌▌░█▒█░░░░█			|$$  | $$| $$  | $$|$$  | $$| $$   $$ | $$    $$| $$  | $$ 			▒▒▒▒▒▒▄▀▀▓▓▓▀█▒▒▒▒▒▒
%█░▄░░█▒█░▐▐▄─▀▀─█─▀▀─▄▌▌░█▒█░░▄░█			|$$__/ $$| $$__/ $$|$$  | $$| $$$$$$\ | $$$$$$$$| $$__/ $$			▒▒▒▒▄▀▓▓▄██████▄▒▒▒▒
%█░░█░█▒█░░▌▄█▄▄▀─▀▄▄█▄▐░░█▒█░█░░█			|$$    $$ \$$    $$|$$  | $$| $$  \$$\ \$$     \ \$$    $$			▒▒▒▄█▄█▀░░▄░▄░█▀▒▒▒▒
%█▄░█████████▀░░▀▄▀░░▀█████████░▄█			\$$$$$$$   \$$$$$$  \$$  \$$ \$$   \$$  \$$$$$$$ _\$$$$$$$			▒▒▄▀░██▄░░▀░▀░▀▄▒▒▒▒
%─██▀░░▄▀░░▀░░▀▄░░░▄▀░░▀░░▀▄░░▀██                                                  			|  \__| $$ 			▒▒▀▄░░▀░▄█▄▄░░▄█▄▒▒▒
%██░░░░░░░░░░░░░░░░░░░░░░░░░░░░░██                                                  		 \$$    $$ 			▒▒▒▒▀█▄▄░░▀▀▀█▀▒▒▒▒▒
%█░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█                                                   		   \$$$$$$ 			▒▒▒▄▀▓▓▓▀██▀▀█▄▀▀▄▒▒
%█░▄░░░░░░░░░░░░░░░░░░░░░░░░░░░▄░█																				▒▒█▓▓▄▀▀▀▄█▄▓▓▀█░█▒▒
%█░▀█▄░░░░░░░░░░░░░░░░░░░░░░░▄█▀░█             __    __ 														▒▒▀▄█░░░░░█▀▀▄▄▀█▒▒▒
%█░░█▀███████████████████████▀█░░█            |  \  /  \    													▒▒▒▄▀▀▄▄▄██▄▄█▀▓▓█▒▒
%█░░█────█───█───█───█───█────█░░█            | $$ /  $$ 														▒▒█▀▓█████████▓▓▓█▒▒
%█░░▀█───█───█───█───█───█───█▀░░█            | $$ /  $$ ______   _______    ______  							▒▒█▓▓██▀▀▀▒▒▒▀▄▄█▀▒▒
%█░░░▀█▄▄█▄▄▄█▄▄▄█▄▄▄█▄▄▄█▄▄█▀░░░█            | $$/  $$ /      \ |       \  /      \ 							▒▒▒▀▀▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
%▀█░░░█──█───█───█───█───█──█░░░█▀            | $$  $$ |  $$$$$$\| $$$$$$$\|  $$$$$$\ 							
%─▀█░░▀█▄█───█───█───█───█▄█▀░░█▀─            | $$$$$\ | $$  | $$| $$  | $$| $$  | $$ 
%──▀█░░░▀▀█▄▄█───█───█▄▄█▀▀░░░█▀──            | $$ \$$\| $$__/ $$| $$  | $$| $$__| $$ 
%───▀█░░░░░▀▀█████████▀▀░░░░░█▀───            | $$  \$$\\$$    $$| $$  | $$ \$$    $$ 
%────▀█░░░░░▄░░░░░░░░░▄░░░░░█▀────             \$$   \$$ \$$$$$$  \$$   \$$ _\$$$$$$$ 
%─────▀██▄░░░▀▀▀▀▀▀▀▀▀░░░▄██▀─────                                         |  \__| $$ 
%────────▀██▄▄░░░░░░░▄▄██▀────────                                          \$$    $$ 
%───────────▀▀███████▀▀───────────                                           \$$$$$$ 


% ====================================================== FUNCOES DE MOVIMENTOS =================================================================
% Cima
% Somente onde há uma escada
s([X,Y], [X,Ynovo],ListaBarris, ListaParedes,ListaEscadas):- Y>0, Ynovo is Y - 1, pertence([X, Y], ListaEscadas), not(pertence([X, Ynovo], ListaParedes)).

% Baixo
% Somente se na posição abaixo há uma escada
s([X,Y], [X,Ynovo],ListaBarris, ListaParedes,ListaEscadas):- Y<4, Ynovo is Y + 1, pertence([X, Ynovo], ListaEscadas), not(pertence([X, Ynovo], ListaParedes)).

% Direita
% Dois casos:
%			1) Caso não haja parede nem barril, anda uma unidade
%			2) Caso haja um barril, anda duas unidades se não houver parede ou outro barril
s([X,Y], [Xnovo,Y],ListaBarris, ListaParedes,ListaEscadas):- X<9, Xnovo is X + 1, not(pertence([Xnovo, Y], ListaParedes)), not(pertence([Xnovo, Y], ListaBarris)).
s([X,Y], [Xnovo,Y],ListaBarris, ListaParedes,ListaEscadas):- X<8, Xnovo is X + 2, Xmid is X+1, not(pertence([Xnovo, Y], ListaParedes)), not(pertence([Xnovo, Y], ListaBarris)), not(pertence([Xnovo, Y], ListaEscadas)), pertence([Xmid, Y], ListaBarris).

% Esquerda
% Dois casos:
%			1) Caso não haja parede nem barril, anda uma unidade
%			2) Caso haja um barril, anda duas unidades se não houver parede ou outro barril
s([X,Y], [Xnovo,Y],ListaBarris, ListaParedes,ListaEscadas):- X>0, Xnovo is X - 1, not(pertence([Xnovo, Y], ListaParedes)), not(pertence([Xnovo, Y], ListaBarris)).
s([X,Y], [Xnovo,Y],ListaBarris, ListaParedes,ListaEscadas):- X>1, Xnovo is X - 2, Xmid is X-1, not(pertence([Xnovo, Y], ListaParedes)), not(pertence([Xnovo, Y], ListaBarris)), not(pertence([Xnovo, Y], ListaEscadas)), pertence([Xmid, Y], ListaBarris).
% ====================================================== FUNCOES DE MOVIMENTOS =================================================================



% ============================================== FUNCOES BASICAS DE MANIPULAÇÃO DE LISTA ======================================================
% Decompor a lista
cons(X,Y,[X|Y]).

% Inverter lista
inverte([],[]).
inverte([E|C], Linv):- inverte(C,C_Inv), concatena(C_Inv,[E], Linv).

% Concatena duas listas
concatena([],L,L).
concatena([H|T],L2,[H|T2]) :- concatena(T,L2,T2).

meta(X, Y) :- X = Y.

% Verififcar se um elemento esta na lista
pertence(E, [E|_]).
pertence(E, [_|Cauda]):- pertence(E, Cauda).
% ============================================== FUNCOES BASICAS DE MANIPULAÇÃO DE LISTA ======================================================


% ==================================================== BUSCA EVOLUTIVA ======================================================
estende([Estado|Caminho],ListaSucessores,ListaBarris, ListaParedes,ListaEscadas):- 
	bagof([Sucessor,Estado|Caminho], (s(Estado,Sucessor,ListaBarris,ListaParedes,ListaEscadas), not(pertence(Sucessor,[Estado|Caminho]))), ListaSucessores),!.
estende( _ ,[], _, _, _). 

bl([[Estado|Caminho]|_],ListaBarris, ListaParedes,ListaEscadas,Objetivo, [Estado|Caminho]) :- meta(Estado, Objetivo).
bl([Primeiro|Outros],ListaBarris, ListaParedes,ListaEscadas,Objetivo, Solucao) :-
	estende(Primeiro,Sucessores,ListaBarris, ListaParedes, ListaEscadas),
	concatena(Outros,Sucessores,NovaFronteira),
	bl(NovaFronteira,ListaBarris,ListaParedes,ListaEscadas,Objetivo, Solucao).
% ==================================================== BUSCA EVOLUTIVA ======================================================


solucao_bl(PosicaoInicial,ListaBarris,ListaParedes,ListaEscadas, Objetivo, Solucao) :- bl([[PosicaoInicial]],ListaBarris, ListaParedes,ListaEscadas,Objetivo, Solucao).


% Funcao principal - 
% Paremetros: posição inicial da busca
%             lista de barris 
%			  lista de paredes
%             lista de escadas
%             posicao do martelo para matar o donkey kong
%             variavel para receber o caminho percorrido

% A Princesa Peach e o Donkey Kong se encontram no último andar e última coluna em todos os casos de teste
main(PosicaoInicial, ListaBarris, ListaParedes, ListaEscadas, PosicaoMartelo, S) :-
	solucao_bl(PosicaoInicial,ListaBarris,ListaParedes,ListaEscadas, PosicaoMartelo, S2),
	cons(X, Y, S2),
	solucao_bl(X, ListaBarris,ListaParedes,ListaEscadas, [9, 0], S3),
	concatena(S3, Y, S4),
	inverte(S4, S).


% Exemplos casos de teste
% SLIDE1
% main([0,4], [[4,4], [5,4], [1,2], [1,0], [5,0], [8,1]], [], [[3,4], [9,3], [6,2], [3,1]], [7,2], S).
% SLIDE2
% main([0,4], [[2,2], [4,2], [6,3], [5,0], [7,1]], [[2,0], [6,4]], [[0,3], [3,4], [3,1], [6,2], [8,4], [9,3]], [9,4], S).
% SLIDE3
% main([0,4], [[5,2], [5,0], [6,3], [6,1], [7,2]], [[3,1], [6,0]], [[8,4], [2,3], [0,2], [9,2], [2,1], [7,1]], [0,0], S).
% SLIDE4
% main([0,4], [[3,3], [3,1], [6,3], [5,0]], [[2,2], [6,0]], [[4,4], [8,3], [0,2], [9,2], [2,1], [4,1], [7,1]], [1,2], S).